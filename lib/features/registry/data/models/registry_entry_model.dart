import 'package:qlm_mobile_suite/features/registry/domain/entities/registry_entry_entity.dart';

class RegistryEntryModel extends RegistryEntry {
  RegistryEntryModel({
    required super.uuid,
    super.serialNumber,
    super.hijriYear,
    super.constraintTypeId,
    super.contractTypeId,
    super.subtype1,
    super.subtype2,
    super.firstPartyName,
    super.secondPartyName,
    super.writerType,
    super.writerId,
    super.otherWriterId,
    super.writerName,
    super.documentHijriDate,
    super.documentGregorianDate,
    super.docRecordBookId,
    super.docRecordBookNumber,
    super.docPageNumber,
    super.docEntryNumber,
    super.docBoxNumber,
    super.docDocumentNumber,
    super.docHijriDate,
    super.docGregorianDate,
    super.feeAmount,
    super.hasAuthenticationFee,
    super.authenticationFeeAmount,
    super.hasTransferFee,
    super.transferFeeAmount,
    super.hasOtherFee,
    super.otherFeeAmount,
    super.penaltyAmount,
    super.supportAmount,
    super.receiptNumber,
    super.sustainabilityAmount,
    super.exemptionType,
    super.exemptionReason,
    super.guardianId,
    super.guardianRecordBookId,
    super.guardianRecordBookNumber,
    super.guardianPageNumber,
    super.guardianEntryNumber,
    super.guardianHijriDate,
    required super.status,
    super.deliveryStatus,
    super.notes,
    super.createdBy,
    super.createdAt,
    super.updatedAt,
    super.isSynced = false,
  });

  factory RegistryEntryModel.fromJson(Map<String, dynamic> json) {
    return RegistryEntryModel(
      uuid: json['uuid'],
      serialNumber: json['serial_number'],
      hijriYear: json['hijri_year'],
      constraintTypeId: json['constraint_type_id'],
      contractTypeId: json['contract_type_id'],
      subtype1: json['subtype_1'],
      subtype2: json['subtype_2'],
      firstPartyName: json['first_party_name'],
      secondPartyName: json['second_party_name'],
      writerType: json['writer_type'],
      writerId: json['writer_id'],
      otherWriterId: json['other_writer_id'],
      writerName: json['writer_name'],
      documentHijriDate: json['document_hijri_date'] != null ? DateTime.parse(json['document_hijri_date']) : null,
      documentGregorianDate: json['document_gregorian_date'] != null ? DateTime.parse(json['document_gregorian_date']) : null,
      docRecordBookId: json['doc_record_book_id'],
      docRecordBookNumber: json['doc_record_book_number'],
      docPageNumber: json['doc_page_number'],
      docEntryNumber: json['doc_entry_number'],
      docBoxNumber: json['doc_box_number'],
      docDocumentNumber: json['doc_document_number'],
      docHijriDate: json['doc_hijri_date'] != null ? DateTime.parse(json['doc_hijri_date']) : null,
      docGregorianDate: json['doc_gregorian_date'] != null ? DateTime.parse(json['doc_gregorian_date']) : null,
      feeAmount: _toDouble(json['fee_amount']),
      hasAuthenticationFee: _toBool(json['has_authentication_fee']),
      authenticationFeeAmount: _toDouble(json['authentication_fee_amount']),
      hasTransferFee: _toBool(json['has_transfer_fee']),
      transferFeeAmount: _toDouble(json['transfer_fee_amount']),
      hasOtherFee: _toBool(json['has_other_fee']),
      otherFeeAmount: _toDouble(json['other_fee_amount']),
      penaltyAmount: _toDouble(json['penalty_amount']),
      supportAmount: _toDouble(json['support_amount']),
      receiptNumber: json['receipt_number'],
      sustainabilityAmount: _toDouble(json['sustainability_amount']),
      exemptionType: json['exemption_type'],
      exemptionReason: json['exemption_reason'],
      guardianId: json['guardian_id'],
      guardianRecordBookId: json['guardian_record_book_id'],
      guardianRecordBookNumber: json['guardian_record_book_number'],
      guardianPageNumber: json['guardian_page_number'],
      guardianEntryNumber: json['guardian_entry_number'],
      guardianHijriDate: json['guardian_hijri_date'] != null ? DateTime.parse(json['guardian_hijri_date']) : null,
      status: json['status'] ?? 'draft',
      deliveryStatus: json['delivery_status'],
      notes: json['notes'],
      createdBy: json['created_by'],
      createdAt: json['created_at'] != null ? DateTime.parse(json['created_at']) : null,
      updatedAt: json['updated_at'] != null ? DateTime.parse(json['updated_at']) : null,
      isSynced: _toBool(json['is_synced']) ?? true,
    );
  }

  Map<String, dynamic> toJson() {
    return {
      'uuid': uuid,
      'serial_number': serialNumber,
      'hijri_year': hijriYear,
      'constraint_type_id': constraintTypeId,
      'contract_type_id': contractTypeId,
      'subtype_1': subtype1,
      'subtype_2': subtype2,
      'first_party_name': firstPartyName,
      'second_party_name': secondPartyName,
      'writer_type': writerType,
      'writer_id': writerId,
      'other_writer_id': otherWriterId,
      'writer_name': writerName,
      'document_hijri_date': documentHijriDate?.toIso8601String(),
      'document_gregorian_date': documentGregorianDate?.toIso8601String(),
      'doc_record_book_id': docRecordBookId,
      'doc_record_book_number': docRecordBookNumber,
      'doc_page_number': docPageNumber,
      'doc_entry_number': docEntryNumber,
      'doc_box_number': docBoxNumber,
      'doc_document_number': docDocumentNumber,
      'doc_hijri_date': docHijriDate?.toIso8601String(),
      'doc_gregorian_date': docGregorianDate?.toIso8601String(),
      'fee_amount': feeAmount,
      'has_authentication_fee': hasAuthenticationFee == true ? 1 : 0,
      'authentication_fee_amount': authenticationFeeAmount,
      'has_transfer_fee': hasTransferFee == true ? 1 : 0,
      'transfer_fee_amount': transferFeeAmount,
      'has_other_fee': hasOtherFee == true ? 1 : 0,
      'other_fee_amount': otherFeeAmount,
      'penalty_amount': penaltyAmount,
      'support_amount': supportAmount,
      'receipt_number': receiptNumber,
      'sustainability_amount': sustainabilityAmount,
      'exemption_type': exemptionType,
      'exemption_reason': exemptionReason,
      'guardian_id': guardianId,
      'guardian_record_book_id': guardianRecordBookId,
      'guardian_record_book_number': guardianRecordBookNumber,
      'guardian_page_number': guardianPageNumber,
      'guardian_entry_number': guardianEntryNumber,
      'guardian_hijri_date': guardianHijriDate?.toIso8601String(),
      'status': status,
      'delivery_status': deliveryStatus,
      'notes': notes,
      'created_by': createdBy,
      'is_synced': isSynced ? 1 : 0,
    };
  }

  static double? _toDouble(dynamic value) {
    if (value == null) return null;
    if (value is int) return value.toDouble();
    if (value is double) return value;
    if (value is String) return double.tryParse(value);
    return null;
  }

  static bool? _toBool(dynamic value) {
    if (value == null) return null;
    if (value is bool) return value;
    if (value is int) return value == 1;
    if (value is String) return value == '1' || value.toLowerCase() == 'true';
    return null;
  }
}
